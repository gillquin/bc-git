parameters:
  - name: SourceRepository
    type: string
    default: ""
  - name: Branch
    type: string
    default: ""

steps:
- checkout: self
  persistCredentials: true

- task: powershell@2
  inputs:
    targetType: 'inline'
    script: |
      $repo = "${{ parameters.SourceRepository }}"
      $branch = "${{ parameters.Branch }}"

      Write-Host "Synching $branch from repo $repo"
      
      git remote add upstream $repo
      git remote

      git fetch --all --prune

      git checkout $branch
      git pull origin $branch

      Write-Host "Pulling $Branch from upstream"
      git pull upstream $branch

      Write-Host "Pushing $Branch to origin"
      git push origin $Branch
      git push origin --tags
